# Initial Setting

## Arduino?

> 오픈 소스를 기반으로 한 단일 보드 마이크로컨트롤러로 완성된 보드와 관련 개발 도구 및 환경을 말한다.

다수의 스위치나 센서로부터 값을 받아들여, LED나 모터와 같은 외부 전자 장치들을 통제함으로써 환경과 상호작용이 가능한 물건을 만들어낼 수 있다. 임베디드 시스템 중의 하나로 쉽게 개발할 수 있는 환경을 이용하여, 장치를 제어할 수 있다.

### Arduino Board

아두이노의 보드는 여러종류가 있고 종류마다 설치해야 하는 보드 설정이 다르다.

**설정하는 방법**

* sketch 상단 툴바에서 툴(도구)에 들어가서 기본 보드 설정을 하고 없는 경우 보드매니저를 통해서 다운받은 후 설치한다.

### 아두이노 동작과정

1. 아두이노와 장치(LED, 모터, 센서, 모듈) 연결
2. 아두이노 개발환경 실행
3. 아두이노 장치를 원하는대로 동작하도록 소스코드(스케치를 통해) 작성
4. 아두이노 개발환경에서 스케치 컴파일
5. 아두이노 개발환경에서 컴파일된 바이너리 파일을 아두이노 보드에 업로드
6. 아두이노가 스케치에 업로드 된 대로 동작

<br>

## Arduino Sketch

아두이노를 사용하기 위한 프로그램인 **Sketch**이다.

### Sketch 구조

![image-20200825201013136](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200825201013136.png)

#### Toolbar

툴바는 자주쓰는 메뉴들을 모아둔 곳으로 왼쪽부터 차례대로 확인, 업로드, 새파일, 열기, 저장 순으로 되어 있다.
소스를 작성한 다음 확인 버튼을 누르게 되면 소스에 대한 컴파일을 실행하게 된다. 이상이 없을 경우, 오른쪽 화살표 모양의 업로드를 누르게 되면 작성한 소스가 아두이노 보드로 올라가 스케치에서 작성한 소스대로 실행된다.

#### Serial Monitor

아두이노는 USB로 PC와 물리적 연결이 되어 있는 상태이고 Serial통신 방법을 이용해서 통신할 수 있다.

* Serial 통신
  : 2개의 핀(TX, RX)을 통해 양쪽이 통신하는 방법이다. PC뿐 아니라 블루투스 모듈, Wifi 모듈과의 통신에도 사용된다.

  아두이노 UNO의 내부에는 USB연결을 통해 Serial통신을 할 수 있게 해주는 변환 칩을 가지고 있다.

  > 아두이노 UNO의 0번 핀과 1번 핀이 이 용도로 사용된다. 따라서 이 핀은 사용하지 않는 편이 좋다.

  * `Serial.begin(9600)`
    : 아두이노 보드의 기본 Serial 연결을 사용하겠다고 아두이노에게 알려주는 역할을 한다.
    
    > 나와 보드 사이의 통신
    
     이때 반드시 통신속도를 지정 해주어야 한다. **Baudrate**라고 부르는데 보통 9600이 기본값처럼 쓰인다.
    이 값은 Serial 통신을 통해 연결되는 쪽에서도 같은 값을 사용해야 한다.
    
    * 사용중에 오작동이 있을 수 있으므로 필요에 따라 온 오프를 설정해줘야 한다.
    
  * `Serial.println("xxx")`함수
    : 따옴표 안의 내용을 상대편으로 전송하는 역할을 한다. 한 라인의 문자열을 보낼 때 사용한다.

#### Text Editor

소스를 작성하는 공간으로 **setup 함수와 loop 함수**, 이 두 함수가 아두이노의 핵심이 되는 함수이다.

setup 함수의 윗 부분에서는 보통 전역 변수나 라이브러리 헤더, 클래스 인스턴트 선언등을 하는 공간이다.

##### setup 함수

`void setup( ) { }`

설정을 담당하는 부분이다.

아두이노 보드의 설정과 관련된 함수를 { } 안에 입력하면 된다.

설정과 관련되어 있기 때문에 아두이노 보드에서 스케치가 실행될 때마다 **한번씩만 실행**된다.
아두이노 보드에 전원이 들어오거나 reset버튼이 들어올때마다 setup이 다시 실행된다.

* `pinMode(pin, mode)` 함수
  : 특정 핀을 on, off 하는 작업을 할 수 있도록 준비하는 함수.
  mode는 `INPUT`, `OUTPUT`을 사용
  * `INPUT`
    : 지정한 핀을 INPUT으로 설정하면 해당 핀은 하이 임피던스 상태가 된다. 이 경우 매우 작은 입력도 쉽게 감지할 수 있지만 해당 핀이 다른 회로에 연결되어 있지 않으면 핀의 값은 무작위로 바뀌게 된다.
    
    inputpullup
    
    inputpulldown
    
  * `OUTPUT`
    : 지정한 핀을 OUTPUT으로 설정하면 해당 핀으로 상당량의 전류를 드라이브 할 수 있다.

##### loop 함수

`void loop( ) { }`

아두이노 보드의 구체적인 동작을 담당하는 부분이다.

* 설정이 끝난 후 구체적인 동작 { } 안에 입력하면 된다.
  * 아두이노 보드에 한번 전원이 들어오면 loop은 무한 반복된다.

**아두이노 스케치는 setup()이 실행된 후 loop()가 무한 반복되는 구조이다.**

* `delay()` 함수
  : 특정 시간동안 작업을 멈추게 하는 함수 ==안쓰는게 좋다==

* Analog

  기계는 아날로그 신호를 제어하기 힘들기 때문에 PWM을 이용해서 사용한다. 켜져있는 주기와 꺼져있는 주기에 따라 밝기를 조절한다. 켜져있고 꺼져있는 설정을 이용하는 함수도 따로 존재한다.

  * `analogRead(pin)`함수
    : 특정 핀을 0~1023 범위의 값으로 출력하는 함수
    * 정밀도의 차이가 생길 수 있기 때문에 센서의 성능에 따라 쓸지 쓰지말지를 결정해야 한다.

  * `analogWrite()` 함수
    : 사용X ==추가 필요==

* Digital
  * `digitalwrite(pin, value)`함수
    : 특정 핀을 on(5V), off(0V) 시키는 함수이다.

  * `digitalRead(pin)`함수
    : 해당 핀이 on(5V)인지 off(0V)인지 결과를 출력해주는 함수이다.

    0과 1로 표현하면 햇갈릴 우려가 있으므로 아두이노에서는 이걸 **LOW(0), HIGH(1)**로 상수로 정의해 두었다.

<br>

## Sensor

### 온습도센서

#### DHT-11

![image-20200826132643473](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200826132643473.png)

**주요사양**

| 습도 측정 범위 | 20-90% RH    |
| -------------- | ------------ |
| 습도 오차 범위 | +_5% RH      |
| 측정 온도 범위 | 0-50도(섭씨) |
| 온도 오차 범위 | +_2%도(섭씨) |
| 동작 전압      | 5V           |
| 소비 전력      | 저전력       |

**원리**

* 습도감지 (저항감지형)
  * DHT 11은 두 전극 사이의 전기 저항을 측정하여 수증기를 감지한다.
    습도 감지 구성 요소는 전극이 표면에 적용된 수분 보유 기판이다.

    * 수증기가 기판에 흡수되면 이온이 기판에 의해 방출되어 전극 사이의 전도성이 증가한다. 두 전극 사이의 저항 변화는 상대 습도에 비례한다.

      즉, 공기중의 습도가 오르면 전류가 더 많이 흐르므로 이를 통해 변화된 저항값으로 습도를 측정할 수 있다.

  1초 이내로 측정하면 안된다.

* 온도 감지
  
  * 온도는 표면에 설치된 NTC 온도 센서 (써미스터)를 사용하여 온도에 따른 물질의 저항치 변화값으로 온도를 측정한다.
  * 바람이나  열풍을 받을 경우 바로 반응하지만 그렇지 않은 경우 온도 변화가 천천히 변한다.
    * 빨리 읽을 필요가 없다.

아두이노의 출력 전압, 전류는 한계가 있다.

* 다 사용하면 안된다. < 여러 센서들을 사용하는데 확인해봐야함 >

checksum 확인



<br>

### PIR 적외선감지센서

####  HC-SR501

![image-20200826162525317](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200826162525317.png)

**주요 사양**

| 감지거리   | 약 7m 까지                   |
| ---------- | ---------------------------- |
| 감지 각도  | 120도                        |
| 출력 전압  | High:3.3V, LOW:0V            |
| 입력 전압  | 5~12V                        |
| 조절 기능  | 민감도, 지연시간, 트리거모드 |
| 인터페이스 | 디지털                       |

**조절 방법**

![image-20200826165054378](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200826165054378.png)

* 감도조절(Distance Adjust)
  : 시계방향으로 돌리면 민감도가 낮춰져서 감지거리가 줄어든다.
* 지연시간(Delay Time Adjust)
  : 인체 감지후 감지된 상태를 얼마간 유지할 것인가 하는 시간을 조절한다. 시계방향으로 돌릴수록 지연시간이 짧아진다.
* 트리거모드
  : 좌측의 점퍼 스위치를 L로 연결하면 감지신호를 한번만 보내주는 코드이고 H는 감지신호를 계속해서 보내주는 모드이다.

**원리**

![image-20200826171438214](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200826171438214.png)

인체의 온도는 36.5도이다. 이 범위는 적외선범위이기 때문에 IR로 표기합니다.
그러나 인체의 온도는 일정하나 사람에 따라서는 방사되는양에 많은 차이가 있기때문에 실제로 IR Detector로 측정하게 되면 보통 9.4 ~10.4 정도로 나타난다.

PIR Sensor는 일정한 양의 적외선을 띄는 물체가 움직이면 감지하여 출력을 내게된다. 그리고 적외선 물체의 움직임이 없으면 출력은 나오지 않게 된다.

* H 모드

  싱글 트리거 모드

  저항으로 딜레이시간으로 조절하고 딜레이 시간동안은 HIGH, 이후에는 감지하고 딜레이 시간 반복

* L 모드

  리피터 모드(?)

  딜레이 시간없이 바로 동작 감지. 딜레이 시간이 계속 유지됨. < 블로킹 타임 발생할 수 있다. >

<br>

### 조도 센서

#### SZH-SSBH-011 모듈

![image-20200826171830778](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200826171830778.png)

##### 사용 부품

**LM393 비교기 모듈**

![image-20200904152451077](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200904152451077.png)

특정 부분의 전압 레벨에 따라 High 또는 LOW값을 출력해주는 모듈로서 여러 모듈에 공통적으로 쓰이는 방식이다. 어떤 변화에 의해 저항값이 바뀌는 소자가 있다면 이에 따라 특정 부분에 걸리는 전압이 달라질 것이고, 이 전압이 어느 값 이상이 되면 LM393비교기 모듈을 통해 HIGH LOW값을 출력해주어 센서 역할을 할 수 있다.

> LOW, HIGH값 뿐만 아니라 아날로그의 값도 표시해줄 수 있다.

* LM393 모듈을 이용한 센서 구성 회로도

  ![image-20200904153435130](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200904153435130.png)

  * OP Amp(Operational Amplifier : 연산 증폭기)
    : 고입력 저항, 저출력 저항, 높은 개방 이득을 특징으로 가지고, +, -단자간의 전압차를 증폭시키는 역할을 하는 차동 증폭기이다.

    ![image-20200904160044616](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200904160044616.png)

**CdS 조도 센서**

![image-20200826181930395](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200826181930395.png)

조도센서는 빛의 양에 따라 저항의 값이 변한다. 조도센서의 지그재그로 된 주황색 부분이 광자의 양을 측정한다.

조도센서는 주의가 밝을수록 광자 양이 많아져 저항값이 작아지고 저항이 감소하면 전류가 많이 흐르게 된다. 반대로 주위가 어두울수록 저항값이 커져 전류가 적게 흐르게 된다.
즉, **주위 밝기는 저항값과 반비례하고 전류에는 비례한다.**

> CdS센서라고 불리는 이유는 카드뮴(Cd)과 황(S)의 화합물인 황화카드뮴(cds)이 주 원료이기 때문이다.

* 조도 센서의 회로도

  ![image-20200904160322452](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200904160322452.png)

  * PC0 (ADC0) (Analog Digital Converter)
    : 아날로그 입력값을 디지털값으로 변환해주는 모듈이다. 

**회로도를 보면 옴의 법칙에 의해서 조도가 높을수록 출력단에서 전압은 감소하고 전류는 증가한다.**



![image-20200904184948056](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200904184948056.png)

##### 사용 원리

LM393 비교기 모듈과 조도센서를 결합시켜 사용한다.
주위 밝기가 밝아지면 광자양이 많아져 내부 저항이 감소한다.  그리고 전압도 감소하므로 빛이 밝아지면 analogRead의 경우 값이 작아진다.

**주요사양**

| 인터페이스 | 아날로그, 디지털                   |
| ---------- | ---------------------------------- |
| 작동 전압  | 3.5~5V                             |
| 핀 구성    | 4핀(GND / VCC / D0 / A0)           |
| 특징       | 가변저항을 조절하여 감도 조정 가능 |

**사용 방법**

![image-20200826181129967](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200826181129967.png)

* 조도 센서 모듈은 아날로그와 디지털 신호값을 출력하는 광량 감지 센서이다.
  
  특징은 빛의 감지에 따라 ON/OFF 타입의 디지털 값이 출력되는 디지털 타입과 빛의 세기를 알 수 있는 아날로그 타입을 모두 제공하기 때문에 둘 중 원하는 타입을 골라서 사용할 수 있다는 장점이 있다. 그리고 빛의 감도를 조절해서 광량을 받아들이는 감도를 조절할 수 있다.
  
  * 아날로그 신호일 경우 들어오는 광량을 측정할 수 있는 반면, 디지털 신호일 경우 빛이 들어오는지 차단되는지만 알 수 있다.

### 아날로그 사운드 센서

#### DFR0034

![image-20200826184429273](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200826184429273.png)

**주요 사양**

| 인터페이스 | 아날로그 |
| ---------- | -------- |
| 작동 전압  | 3.5~5V   |

**사용 방법**

아날로그 신호를 입력하면 값이 나오게 된다. 따로 조절하는 부분은 없다.

**원리**

소리 감지센서는 '공기의 진동'을 인식해서 그에 따른 전압을 출력해주게 된다.
바람이 불어서도 소리로 인식하기 때문에 마이크나 스피커로 사용될 수 있다.

### NeoPixel

LED 한개를 켜기 위해서 1개의 전원 단자(핀)이 필요하지만 Neopixel은 전원과 제어용 데이터핀만 있으면 많은 LED를 제어할 수 있다.

![image-20200826190157055](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200826190157055.png)

스틱 타입

![image-20200826190220410](C:\Users\klop0\AppData\Roaming\Typora\typora-user-images\image-20200826190220410.png)

**주요사양**

| 인터페이스 | 디지털 |
| ---------- | ------ |
| 작동전압   | 5V     |

**사용방법**

라이브러리가 필요하므로 외부 라이브러리를 다운받아서 사용함

* dafruit_NeoPixel

**begin은 기본값을 다 없도록 하는 명령**

**원리**

데이터를 neopixel에 넣어야 하므로 led의 개수와 특성을 알아야함==check==