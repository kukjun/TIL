# 파일 접근 권한 관리하기

### 학습 목표 및 학습 내용

#### 1) 학습목표

* 파일의 속성과 접근 권한의 개념을 이해한다.
* 접근 권한을 변경하는 방법을 익힌다.
* 접근 권한을 상속하고 초기에 설정하는 방법을 익힌다.

#### 2) 학습 내용

* 파일의 속성
* 파일의 접근 권한
* 기호를 이용한 파일 접근 권한 변경
* 숫자를 이용한 파일 접근 권한 변경
* 기본 접근 권한의 설정

## 01. 파일의 속성

#### 1) 다중 사용자 시스템의 특징

* 여러 사람이 하나의 시스템 사용 
* 다른 사람이 내 파일을 읽거나 수정, 삭제 할 수 없도록 보안 기능 필요
* 다른 사용자의 무단 접근으로부터 자신의 파일을 보호하는 기능으로 파일에 접근 권한을 부여하여 권한 만큼만 파일을 사용할 수 있도록한다.

#### 2) 파일의 속성

* 유닉스에서 파이릉 관리하기 위해 저장하는 정보들
* ls -l 명령으로 파일의 속성을 확인할 수 있음

#### 3. ls -l 명령

```bash
$ ls -l ~/Unix/ch5/ls.out
-rw-r--r-- 1 student1 students 197 1월 7 14:43 ls.out
```

| 값          | 의미                                        |
| ----------- | ------------------------------------------- |
| -           | 파일 종류 (-: 일반파일, d: 디렉토리)        |
| rw-r--r--   | 파일을 읽고, 쓰고, 실행할 수 있는 권한 표시 |
| 1           | 물리적 연결 개수                            |
| student1    | 파일 소유자의 사용자 명                     |
| students    | 파일 소유자의 그룹명                        |
| 197         | 파일크기 (바이트 단위)                      |
| 1월 7 14:43 | 파일이 마지막으로 변경된 시간               |
| ls.out      | 파일명                                      |

###  1. 파일의 종류

#### 1) 파일 종류 표시

| 문자 | 파일 유형                                 |
| ---- | ----------------------------------------- |
| -    | 일반 (정규) 파일                          |
| d    | 디렉토리 파일                             |
| b    | 블록 단위로 읽고 쓰는 블럭 장치 특수 파일 |
| c    | 문자 단위로 읽고 쓰는 문자 장치 특수 파일 |
| l    | 기호적 링크                               |
| p    | 파이프                                    |
| s    | 소켓                                      |

#### 2) 관련 명령

```
file 파일명
```

### 2. 파일이 속한 그룹

#### 1) 사용자명 저장

```
groups [ 사용자명 ]
```

* 인자로 지정한 사용자가 속한 그룹 이름 출력
  * 인자가 없으면 자신이 속한 그룹이름 출력

## 02. 파일의 접근 권한

* **파일을 읽고, 쓰고, 실행할 수 있는 권한**
  * 다중 사용자 시스템의 가장 기본적인 보안 기능

#### 1) 유닉스의 사용자 카테고리

* 소유자
  * 일반적으로 파일을 생성한 사용자. 명령을 통해 변경할 수도 있음
* 그룹
  * 파일과 동일한 그룹에 속한 사용자들
  * 파일이 속한 그룹?
    * 일반적으로 파일을 생선한 사용자의 기본 그룹
    * 상위 디렉토리에 특수한 권한(setgrid)이 부여된 경우 다른 그룹으로 지정
    * 명령을 이용하여 변경 가능
* 기타 사용자
  * 송자나 그룹 카테고리에 속하지 않은 모든 사용자들

**접근 권한은 카테고리 별로 다르게 부여**

### 1. 접근 권한의 종류

#### 1) 기본 권한

* 읽기(r), 쓰기(w), 실행(x)
* 파일의 종류에 따라 의미가 다름

| 모드    | 일반 파일                                                    | 디렉토리 파일                                                | 특수 파일                              |
| ------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------------------------------- |
| 읽기(r) | 파일내용을 읽거나 복사할 수 있다.                            | ls 명령으로 디렉토리 목록을 읽을 수 있다.                    | read()를 사용하여 파일을 읽을 수 있다. |
| 쓰기(w) | 파일을 수정/이동/삭제 시킬 수 있다. (디렉토리에 쓰기 권한이 있어야 함) | 디렉토리 내에 파일을 생성, 삭제할 수 있다.                   | write() 를 사용하여 파일을 쓸 수 있다. |
| 실행(x) | 파일을 실행 시킬 수 있다. (실행 가능한 파일의 경우)          | cd 명령을 이용하여 디렉토리로 이동할 수 있고 파일을 디렉토리로 이동하거나 복사 할 수 있다. | 아무런 의미가 없다.                    |

### 2. 접근 권한 표기방법

```
파일 형식을 제외한 9칸 중 앞부터 순서대로 소유자 3 그룹 사용자 3 기타 사용자 3을 의미한다.
```

* 문자의 의미

  * r: 읽기 허가, w: 쓰기 허가, x: 실행 허가,  -: 허가 취소

## 03. 파일 접근권한 변경

**자신이 소유한 파일의 사용 권한을 변경**

```
chmod [옵션] 모드 파일명
```

* 옵션
  * -R : 하위 디렉토리까지 모두 변경
* 모드
  * 변경할 사용 권한 표시
  * 종류 : 기호 모드, 8진수 모드

#### 1) 기호를 이용한 파일 접근권한 변경

```bash
# chmod (사용자카테고리)(연산자)(권한) 파일명
chmod u+r filetest.txt
```

| 사용자 카테고리 | 의미               | 연산자 기호 | 의미                        | 권한 기호 | 의미      |
| --------------- | ------------------ | ----------- | --------------------------- | --------- | --------- |
| u               | 소유자             | +           | 허가권 부여                 | r         | 읽기 허가 |
| g               | 그룹               | -           | 허가권 제거                 | w         | 쓰기 허가 |
| o               | 기타 사용자        | =           | 특정 사용자에게 허가권 지정 | x         | 실행허가  |
| a               | 모든 사용자(u+g+o) |             |                             |           |           |

#### 2) 숫자를 이용한 파일 접근권한 변경

```bash
# chmod (소유자8진수)(그룹8진수)(기타8진수) 파일명
ex) chmod 511 test_file.txt
```



* 모든 카테고리의 접근 권한을 동시에 조정할 때 기호모드보다 편리
* 각 카테고리 별로 접근 권한을 하나의 8진수로 표현
* 3개의 8진수를 사용하여 전체 접근 권한 표기

##### a) 표시 방법

* 사용권한
  * 사용권한이 있으면 1, 없으면 0인 2진수로 표현

* 2진수로 대체
  * 예를 들어 소유자그룹이 rwx 이면 111

* 8진수로 표현
  * 소유자 그룹이 111이면 7을 의미

* 한번에 표현
  * 그룹 rw-, 기타 사용자r--이면 chmod 764 파일명

## 04. 기본 접근 권한의 설정

#### 1) 기본 접근 권한

* 유닉스에서 새로운 파일이나 디렉토리를 만들 때 부여되는 접근 권한

  | 파 일                                                | 기본 접근 허가권 |
  | ---------------------------------------------------- | ---------------- |
  | 실행할 수 없는 일반 파일 (문서 편집기로 생성한 파일) | 666              |
  | 실행할 수 있는 일반 파일                             | 777              |
  | 디렉토리                                             | 777              |

### 1. umask

* **기본 접근권한을 출력하거나 변경**

```bash
# umask [마스크값]
```

* 마스크 값
  * 파일이나 디렉토리 생성시 부여하지 않을 권한 지정
  * 이 값을 지정하면 지정한 마스크를 이용하여 기본 접근권한 지정
  * 지정하지 않으면 현재 설정된 마스크 값 출력

### 2. 마스크 값

#### 1) 마스크 -> 가리다

* 사용 권한에서 허용하지 않을 값을 지정

#### 2) 간단한 계산 방법

| 1)   | 최대권한      | rw- rw- rw-    | 666  |
| ---- | ------------- | -------------- | ---- |
| 2)   | 마스크값(022) | ---   -w-  -w- | 022  |
| 3)   | 뺄셈결과      | rw-  r--   r-- | 644  |


