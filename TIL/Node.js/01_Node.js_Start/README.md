# 01. 노드 시작하기

Node.js(이하 노드)가 무엇인지, 어디에 쓰이는지, 누가 쓰고 있는지를 알아보고, 노드의 핵심 개념들을 다룬다.

노드와 비주얼 스튜디어 코드를 설치하는 방법도 알아본다.

<br>

## 1.1 핵심 개념 이해하기

* **노드의 정의**

  'Node.js는 크롬 V8 자바 스크립트 엔진으로 빌드된 자바스크립트 런타임입니다.  Node.js는 이벤트 기반, 논블로킹 I/O 모델을 사용해 가볍고 효율적입니다. Node.js의 패키지 생태계인 npm은 세계에서 가장 큰 오픈 소스 라이브러리 생태계이기도 합니다.' - 노드 공식 사이트(https://nodejs.org/ko/)

노드는 서버로만 사용되는 것뿐만이 아니라 자바 스크립트 프로그램을 운영하는 런타임으로도 사용한다.

<br>

### 1.1.1 서버

노드를 통해서 다양한 자바스크립트 애플리케이션을 실행할 수 있지만, 노드는 서버 애플리케이션을 실행하는데 가장 많이 사용한다.

* 서버의 정의

  서버는 네트워크를 통해 클라이언트에 정보나 서비스를 제공(응답)하는 컴퓨터 또는 프로그램을 말한다.

  * 클라이언트는 요청을 보내는 주체로 브라우저일 수도 있고 데스크톱 프로그램일 수도 있고, 모바일 앱일 수도 있고, 다른 서버에 요청을 보내는 서버일수도 있다.
  * 응답은 항상 Yes가 아니고 No를 할 수도 있다. No를 하면 접근을 차단한다는 뜻이다.


* 예시

  길벗 출판사에 방문한다고 생각해보면,

  1. 주소창에 길벗출판사의 웹 사이트 주소를 입력(**요청**)하면 브라우저는 그 주소에 해당하는 길벗출판사의 컴퓨터 위치를 파악한다.
  2. 그 컴퓨터(서버)에서 길벗 출판사의 웹 사이트 페이지를 받아와 요청자의 브라우저(클라이언트)에 띄워준다.(**응답**)

노드는 자바스크립트 애플리케이션이 서버로서 기능하기 위한 도구를 제공하므로 서버 역할을 수행할 수 있다.

<br>

###  1.1.2 자바스크립트 런타임

**노드는 자바스크립트 런타임이다.** 런타임은 특정 언어로 만든 프로그램들을 실행할 수 있는 환경을 뜻한다. 따라서 **노드는 자바스크립트 언어를 컴퓨터에서 실행할 수 있게 해준다.**

노드는 V8 더불어 ilbuv라는 라이브러리를 사용한다. <u>libuv 라이브러리는 노드의 특성인 이벤트 기반, 논블로킹 I/O 모델을 구현</u>하고 있다.

<br>

### 1.1.3 이벤트 기반

이벤트 기반(event-driven)이란 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식을 의미한다. 이벤트로는 클릭이나 네트워크 요청등을 들 수 있다.

이벤트 기반 시스템에서는 특정 이벤트가 발생할 때 무엇을 할지 미리 등록해두어야 한다. 이것을 <u>이벤트 리스너(event listener)에 콜백(callback)함수를 등록한다고 표현</u>한다.

노드도 이벤트 기반 방식으로 동작하므로 이벤트가 발생하면 이벤트 리스너에 등록해둔 콜백 함수를 호출합니다. 발생한 이벤트가 없거나 발생했던 이벤트를 다 처리하면 노드는 다음 이벤트가 발생할 때 까지 대기합니다.

* 예시

  버튼을 누르면 경고창을 띄운다고 생각해보면,

  클릭 이벤트 리스너에 경고창을 띄우는 콜백 함수를 등록해두면 클릭 이벤트가 발생할 때마다 콜백 함수가 실행돼 경고 창이 뜬다.

* 예제

  1/1000초 이후에 코드를 실행하는 setTimeout를 사용해 콘솔에 어떤 로그가 기록될지 예측해보자.

  ```javascript
  function run() {
      console.log('3초 후 실행');
  }
  console.log('시작');
  setTimeout(run, 3000);
  console.log('끝');
  ```

  콘솔 결과는 쉽게 예측할 수 있지만, 호출 스택으로 설명하기는 힘들다. setTimeout 함수의 콜백인 run이 호출 스택에 언제 들어가는지 알기 어렵기 때문이다. 이를 파악하기 위해서는 이벤트 루프, 태스크 큐, 백그라운드를 알아야한다.

  * 이벤트 루프

    이벤트 발생 시 호출할 콜백 함수들을 관리하고, 호출된 콜백 함수의 실행 순서를 결정하는 역할을 담당한다. 노드가 종료될 때까지 이벤트 처리를 위한 작업을 반복하므로 루프라고 불린다.

  * 태스크 큐

    이벤트 발생후 호출 되어야 할 콜백 함수들이 기다리는 공간입니다. 콜백들이 이벤트 루프가 정한 순서대로 줄을 서 있으므로 콜백 큐라고도 불린다.

  * 백그라운드

    타이머나 I/O작업 콜백 또는 이벤트 리스너들이 대기하는 곳

<br>

### 1.1.4 논블로킹 I/O

이벤트 루프를 잘 활용하면 오래 걸리는 작업을 효율적으로 처리할 수 있다.

* 논블로킹 방식

   오래 걸리는 함수를 백그라운드로 보내서 다음 코드가 먼저 실행되게 하고, 그 함수가 다시 태스크 큐를 거쳐 호출 스택으로 올라오기를 기다리는 방식이다. **논 블로킹 방식은 이전 작업이 완료될 때 까지 멈추지 않고 다음 작업을 수행함을 뜻한다.**

  * 예제

    ```javascript
    function longRunningTask() {
        // 오래 걸리는 작업
        console.log('작업 끝');
    }
    console.log('시작');
    setTimeout(longRunningTask, 0);
    console.log('다음 작업');
    ```

    * setTimeout(콜백, 0)은 지연시간(1ms)이 있기 때문에 console('다음 작업')보다 먼저 실행되지 않는다.

* 블로킹 방식

  이전 작업을 완료하고 다음 작업을 수행하는 방식

  * 예제

    ```javascript
    function longRunningTask() {
        // 오래 걸리는 작업
        console.log('작업 끝');
    }
    console.log('시작');
    longRunningTask();
    console.log('다음 작업');
    ```

<br>

### 1.1.5 싱글 스레드

* 스레드

  프로세스 내에서 실행되는 흐름의 단위이다. 하나의 프로세스는 스레드를 여러개 가질 수 잇다. 스레드들은 부모 프로세스의 자원을 공유하므로 같은 메모리에 접근할 수 있다.

싱글 스레드는 **주어진 작업을 혼자서 처리해야한다.**

멀티 스레드는 여러 개의 스레드가 일을 나너서 처리할 수 있습니다.

* 블로킹

  어떤 스레드의 진행 상태에 따라 다른 스레드의 작업이 막힐 수 있다.

* 논블로킹

  시간이 오래 걸리는 작업의 경우 백 그라운드로 넘겨서 빠르게 순서대로 실행된다.

노드로 싱글 스레드 여러 개를 사용해 멀티 스레딩과 비슷한 기능을 하게 할 수 있다. 하지만 이는 멀티 프로세싱에 가깝다.

* 프로세스

  운영체제에서 항당하는 작업의 단위로, 노드나 인터넷 브라우저 같은 프로그램은 개별적이 프로세스이다. 프로세스간에 메모리 등의 자원을 공유하지 않는다.

* 노드 프로세스

  노드 프로세스는 <u>싱글스레드 논블로킹 모델</u>로 싱글스레드 블로킹 모델보다 속도가 빠르고, 멀티 스레드 블로킹 모델보다 컴퓨터 자원을 적게 쓰지만 스레드에 문제가 생길경우 전체 일이 진행될 수 없고 또 블로킹이 심하게 일어나는 경우 시간이 오래 걸릴 수 있다.

  * request가 많은 경우엔 블로킹이 심하게 일어나는 경우가 있다.
    * 사람이 많은 경우 check

  사실 노드 프로세스도 여러개의 스레드를 가지지만 제어할 수 있는 스레드가 하나 뿐이라서 싱글 스레드라고 부른다.

  * 백그라운드에서 다른 스레드 들도 있고 테스크 큐도 있다.

  노드는 스레드를 늘리는 대신 프로세스 자체를 복사에 여러 작업을 동시에 처리하는 멀티 프로세싱 방식을 택했다. 자바스크립트 언어 자체가 싱글 스레드 특성을 띄고 있기 때문이다.

## 1.2 서버로서의 노드

노드가 싱글 스레드, 논블로킹 모델을 사용하므로 노드 서버도 동일한 모델을 사용한다.

* 노드 서버의 특징

  * 싱글 스레드 이므로 컴퓨터 자원을 적게 사용하지만  CPU코어를 하나밖에 사용하지 못한다.
* 노드는 libuv 라이브러리를 이용해 I/O작업을 논 블로킹 방식으로 처리해기 때문에 스레드 하나가 많은 수의 I/O를 혼자서도 감당할 수 있어 I/O가 많은 작업에 적합하다. 하지만 CPU부하가 큰 작업에는 적합하지 않고, CPU부하가 발생하면 블로킹이 발생해 스레드 하나에서 감당하기 어렵다.
  * 싱글 스레드 방식의 프로그래밍이 멀티 스레드 방식보다 상대적으로 쉽다. 하지만 스레드가 에러로 인해 멈추면 서버 전체가 멈춘다.
* 웹서버가 내장되어 있다. 하지만 규모가 커지면 따로 웹 서버와 노드 서버를 연결해야 한다.
  * 자바스크립트 언어를 사용하고, 웹 브라우저도 자바스크립트를 사용하므로, **하나의 언어로 웹 사이트를 개발할 수 있다.** 이는 **개발 생산성을 획기적으로 높여주어 생산성이 중요한 기업이 노드를 채택하는 이유가 되었다.**
* JSON 형식과 호환하기 쉽다.
  
|                      장점                       |                        단점                         |
  | :---------------------------------------------: | :-------------------------------------------------: |
| 멀티 스레드 방식에 비해 컴퓨터 자원을 적게 사용 | 싱글 스레드 이므로 CPU코어를 하나밖에 사용하지 못함 |
  |             I/O가 많은 작업에 적합              |           CPU작업이 많은 서버로는 부적합            |
  |            멀티 스레드 방식보다 쉬움            |   하나뿐이 스레드가 멈추지 않도록 잘 관리해야 함    |
  |             웹서버가 내장되어 있음              |    서버 규모가 커졌을 때 서버를 관리하기 어려움     |
  |           **자바 스크립트를 사용함**            |                    어중간한 성능                    |
  |            JSON 형식과 호환하기 쉬움            |                                                     |



네트워크, 데이터베이스, 디스크 작업같은 I/O 특화된 특성을 활용하기 위해서는 개수는 많지만 크기는 작은 데이터들을 실시간으로 주고 받는 데 적합하다.

* 예시

  실시간 채팅 어플리케이션, 주식 차트, JSON 데이터를 제공하는 API서버가 노드를 많이 사용한다.

CPU를 많이 사용하는 작업은 노드를 사용하는데 적합하지 않다.

* 예시

  이미지, 비디오처리, 대규모 데이터 처리 등등

쇼핑몰, 블로그와 같은 웹사이트의 경우에는 장점이 뚜렷하지는 않지만 사용하는데 문제사항은 없다.

<br>

## 1.3 서버 외의 노드

처음에는 대부분 노드를 서버로 사용했지만 노드는 자바스크립트 런타임이기 때문에 서버 뿐만이 아니라 웹, 모바일, 데스크톱 애플리케이션 개발에도 사용되기 시작했다.

웹프레임워크

* 종류

  Angular, React, Vue, Meteor

모바일 개발 도구

* 종류

  React Native, Ionic Framework

데스크톱 개발도구

* 종류

  Electron

  * Visual Studio Code도 Electron으로 만들어졌다.